<html>
  <head>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/p5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.4.5/addons/p5.dom.js"></script>
    <script src="./lib/p5.speech.js"></script>
    <script type="text/javascript" src="./constants.js"></script>
    <script>
      var myVoice = new p5.Speech(); // new P5.Speech object

      var menuLoaded = 0;
      var label, input, checkbox, speakbutton, vslider, rslider, pslider; // UI

      function setup() {
        // input dialog:
        input = createInput("10");
        input.style("width", 400);
        input.position(20, 65);
        // checkbox:
        checkbox = createInput(0, 1, 0);
        checkbox.attribute("type", "checkbox");
        checkbox.style("width", "15px");
        checkbox.style("height", "15px");
        checkbox.position(100, 100);
        // button:
        speakbutton = createButton("Speak");
        speakbutton.position(20, 100);
        speakbutton.mousePressed(doSpeak);
        // sliders:
        vslider = createSlider(0, 100, 100);
        vslider.position(20, 140);
        vslider.mouseReleased(setVolume);
        rslider = createSlider(10, 200, 100);
        rslider.position(20, 160);
        rslider.mouseReleased(setRate);
        pslider = createSlider(1, 200, 100);
        pslider.position(20, 180);
        pslider.mouseReleased(setPitch);
        // labels:
        label = createDiv("say something:");
        label.position(20, 40);
        label = createDiv("interrupt?");
        label.position(125, 100);
        label = createDiv("volume");
        label.position(160, 140);
        label = createDiv("rate");
        label.position(160, 160);
        label = createDiv("pitch");
        label.position(160, 180);

        // say hello:
        // doSpeak();
      }

      function setVolume() {
        myVoice.setVolume(vslider.value() / 100);
      }
      function setRate() {
        myVoice.setRate(rslider.value() / 100);
      }
      function setPitch() {
        myVoice.setPitch(pslider.value() / 100);
      }

      function draw() {
        // why draw when you can click?
      }

      function convert_millions(num) {
        if (num >= 1000000) {
          return (
            convert_millions(Math.floor(num / 1000000)) +
            " million " +
            convert_thousands(num % 1000000)
          );
        } else {
          return convert_thousands(num);
        }
      }

      function convert_thousands(num) {
        if (num <= 1110) return convert_hundreds(num);
        return (
          hundreds[Math.floor((num - 11) / 100)] +
          convert_tens(num - Math.floor((num - 11) / 100) * 100)
        );
      }

      function convert_hundreds(num) {
        if (num <= 110) return convert_tens(num);
        return (
          hundreds[Math.floor((num - 11) / 100)] +
          convert_tens(num - Math.floor((num - 11) / 100) * 100)
        );
      }

      function convert_tens(num) {
        if (num <= 10) return ones[num % 11];
        if (num % 10 == 0)
          return tens[Math.floor(num / 10) - 1] + " e " + ones[10];
        return tens[Math.floor(num / 10)] + " e " + ones[num % 10];
      }

      function convertNumToNumTilde(num) {
        if (num == 0) return "epsilon";
        else return convert_millions(num);
      }

      function doSpeak() {
        myVoice.interrupt = checkbox.elt.checked;
        const NumTildeValue = convertNumToNumTilde(int(input.value()));
        // console.log(NumTildeValue);
        myVoice.speak(NumTildeValue); // debug printer for voice options
      }
    </script>
  </head>
  <body></body>
</html>
